<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TicketCore - Eventos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; }

        /* HERO & UI */
        .home-hero {
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1533174072545-e8d4aa97edf9?q=80&w=2070') center/cover;
            height: 500px; display: flex; align-items: center; justify-content: center; color: white; border-radius: 0 0 30px 30px;
            margin-bottom: 40px;
        }
        .search-hero {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 30px 0; color: white; border-radius: 0 0 20px 20px;
            margin-bottom: 30px;
        }

        /* CARDS */
        .card { border: none; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.05); overflow: hidden; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .card-img-top { height: 200px; object-fit: cover; }
        .price-badge { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: #fff; padding: 5px 12px; border-radius: 20px; font-weight: bold; }

        /* UTILS */
        .app-section { display: none; opacity: 0; transition: opacity 0.3s; }
        .active-section { display: block; opacity: 1; }
        .cursor-pointer { cursor: pointer; }
        .admin-controls { display: none; } /* Se activa con JS si es Admin */
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow">
    <div class="container">
        <a class="navbar-brand fw-bold" href="#" onclick="nav('home')"><i class="bi bi-ticket-detailed-fill"></i> TicketCore</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item"><a class="nav-link" href="#" onclick="nav('home')">Inicio</a></li>
                <li class="nav-item"><a class="nav-link" href="#" onclick="nav('buscador')">Buscador</a></li>
            </ul>

            <ul class="navbar-nav ms-auto align-items-center gap-2">
                <li class="nav-item d-none" id="nav-cart">
                    <button class="btn btn-outline-warning position-relative" onclick="abrirCarrito()">
                        <i class="bi bi-cart-fill"></i> Carrito
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="cart-count">0</span>
                    </button>
                </li>

                <li class="nav-item" id="nav-login">
                    <button class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#loginModal">Acceder</button>
                    <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#registerModal">Registro</button>
                </li>
                <li class="nav-item dropdown d-none" id="nav-user">
                    <a class="nav-link dropdown-toggle text-white" href="#" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle"></i> <span id="user-name">User</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item text-danger" href="#" onclick="logout()">Cerrar Sesi√≥n</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div id="sec-home" class="app-section active-section">
    <div class="home-hero text-center px-3">
        <div>
            <h1 class="display-3 fw-bold mb-3">Tu m√∫sica, en vivo.</h1>
            <p class="lead mb-4 fs-4">Descubre los mejores conciertos y festivales de Espa√±a.</p>
            <button class="btn btn-warning btn-lg fw-bold px-5 rounded-pill shadow" onclick="nav('buscador')">
                <i class="bi bi-search"></i> Buscar Entradas
            </button>
        </div>
    </div>
    <div class="container my-5">
        <h3 class="mb-4 border-start border-4 border-warning ps-3">√öltimas Noticias</h3>
        <div class="row g-4">
            <div class="col-md-4"><div class="card h-100"><div class="card-body">
                <span class="badge bg-danger mb-2">Noticia</span>
                <h5>üé∏ Gira Mundial 2026</h5><p class="text-muted">Las bandas m√°s grandes confirman nuevas fechas en Madrid y Barcelona.</p>
            </div></div></div>
            <div class="col-md-4"><div class="card h-100"><div class="card-body">
                <span class="badge bg-primary mb-2">Tecnolog√≠a</span>
                <h5>üé´ Entradas 100% Digitales</h5><p class="text-muted">Olv√≠date del papel. Accede al recinto con tu c√≥digo QR seguro.</p>
            </div></div></div>
            <div class="col-md-4"><div class="card h-100"><div class="card-body">
                <span class="badge bg-success mb-2">Novedad</span>
                <h5>üèüÔ∏è Nuevos Recintos</h5><p class="text-muted">TicketCore ampl√≠a su cobertura a Valencia y Bilbao.</p>
            </div></div></div>
        </div>
    </div>
</div>

<div id="sec-buscador" class="app-section">
    <div class="search-hero">
        <div class="container">
            <h3 class="mb-3"><i class="bi bi-search"></i> Encuentra tu evento ideal</h3>

            <div class="card p-3 shadow border-0 text-dark">
                <div class="row g-2">
                    <div class="col-md-3">
                        <label class="small text-muted">Ciudad</label>
                        <select id="s-ciudad" class="form-select">
                            <option value="">Todas las ciudades</option>
                            <option value="Madrid">Madrid</option>
                            <option value="Barcelona">Barcelona</option>
                            <option value="Valencia">Valencia</option>
                            <option value="Bilbao">Bilbao</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="small text-muted">B√∫squeda</label>
                        <input id="s-key" class="form-control" placeholder="Artista, evento...">
                    </div>
                    <div class="col-md-2">
                        <label class="small text-muted">Fecha desde</label>
                        <input type="date" id="s-fecha" class="form-control">
                    </div>
                    <div class="col-md-2">
                        <label class="small text-muted">G√©nero</label>
                        <select id="s-genero" class="form-select">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button class="btn btn-warning w-100 fw-bold" onclick="buscarEventos(0)">Buscar</button>
                    </div>
                </div>
            </div>

            <div class="mt-3 text-center admin-controls">
                <button class="btn btn-light text-primary fw-bold btn-sm shadow" onclick="abrirModalEvento()">
                    <i class="bi bi-plus-circle"></i> Panel Admin: Crear Evento
                </button>
            </div>
        </div>
    </div>

    <div class="container my-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="text-secondary" id="results-info">Resultados</h5>
        </div>

        <div id="eventos-grid" class="row g-4">
        </div>

        <div class="d-flex justify-content-center mt-5 gap-2">
            <button class="btn btn-outline-secondary" id="btn-prev" onclick="cambiarPagina(-1)">Anterior</button>
            <span class="btn btn-light disabled" id="page-info">1</span>
            <button class="btn btn-outline-secondary" id="btn-next" onclick="cambiarPagina(1)">Siguiente</button>
        </div>
    </div>
</div>

<div class="modal fade" id="detailModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 overflow-hidden shadow-lg">
            <div class="row g-0">
                <div class="col-md-5 bg-dark d-flex align-items-center justify-content-center">
                    <img id="d-img" src="" class="w-100" style="object-fit: cover; height: 100%; min-height: 350px;">
                </div>
                <div class="col-md-7">
                    <div class="modal-header border-0"><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                    <div class="modal-body px-4 pt-0">
                        <span class="badge bg-primary mb-2" id="d-date">Fecha</span>
                        <h2 class="fw-bold mb-2" id="d-title">T√≠tulo</h2>
                        <h3 class="text-warning fw-bold mb-3" id="d-price">0.00 ‚Ç¨</h3>

                        <p class="text-muted" id="d-desc">Descripci√≥n...</p>

                        <hr>
                        <div class="d-flex align-items-center gap-3">
                            <div class="input-group" style="width: 140px;">
                                <span class="input-group-text">Cant.</span>
                                <input type="number" id="d-qty" class="form-control text-center" value="1" min="1" max="10">
                            </div>
                            <button class="btn btn-dark flex-grow-1 py-2 fw-bold" onclick="agregarAlCarrito()">
                                <i class="bi bi-cart-plus"></i> A√±adir al Carrito
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="cartModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title fw-bold"><i class="bi bi-cart4"></i> Tu Carrito de Compra</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <div id="cart-loading" class="text-center py-3 d-none"><div class="spinner-border text-warning"></div></div>
                <ul class="list-group list-group-flush" id="cart-list">
                </ul>
                <div class="p-3 text-end bg-light border-top">
                    <h4>Total: <span id="cart-total" class="text-primary fw-bold">0.00 ‚Ç¨</span></h4>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Seguir mirando</button>
                <button class="btn btn-success fw-bold px-4" onclick="checkout()">
                    <i class="bi bi-credit-card"></i> Pagar y Finalizar
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="eventoModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
    <div class="modal-header bg-primary text-white"><h5 class="modal-title" id="eventoModalTitle">Evento</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
        <form id="eventoForm">
            <input type="hidden" id="evId">
            <div class="mb-2"><label>T√≠tulo</label><input type="text" id="evTitulo" class="form-control" required></div>
            <div class="row">
                <div class="col-6 mb-2"><label>Precio</label><input type="number" step="0.01" id="evPrecio" class="form-control" required></div>
                <div class="col-6 mb-2"><label>Fecha</label><input type="datetime-local" id="evFecha" class="form-control" required></div>
            </div>
            <div class="mb-2"><label>Imagen URL</label><input type="url" id="evImage" class="form-control"></div>
            <button type="button" class="btn btn-primary w-100 mt-3" onclick="guardarEvento()">Guardar</button>
        </form>
    </div>
</div></div></div>

<div class="modal fade" id="loginModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content p-4"><h3 class="mb-3">Login</h3><form id="formLogin"><input id="logEmail" class="form-control mb-2" placeholder="Email" required><input type="password" id="logPass" class="form-control mb-3" placeholder="Contrase√±a" required><button class="btn btn-primary w-100">Entrar</button></form></div></div></div>
<div class="modal fade" id="registerModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content p-4"><h3 class="mb-3">Registro</h3><form id="formRegister"><input id="regName" class="form-control mb-2" placeholder="Nombre" required><input id="regEmail" class="form-control mb-2" placeholder="Email" required><input type="password" id="regPass" class="form-control mb-2" placeholder="Contrase√±a" required><div class="form-check mb-3"><input type="checkbox" id="regAdmin" class="form-check-input"><label class="small">Soy Empresa (Admin)</label></div><button class="btn btn-success w-100">Registrar</button></form></div></div></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // --- ESTADO GLOBAL ---
    let user = JSON.parse(localStorage.getItem('ticketUser'));
    let curPage = 0;
    let totalPages = 0;
    let selectedEventId = null;

    // --- INICIALIZACI√ìN ---
    document.addEventListener('DOMContentLoaded', () => {
        updateUserUI();
        cargarGeneros();
        if(user) cargarCarritoCount();
        // Por defecto no cargamos eventos en home para no saturar, se cargan al ir a buscador
    });

    function nav(sec) {
        document.querySelectorAll('.app-section').forEach(el => el.classList.remove('active-section'));
        document.getElementById('sec-' + sec).classList.add('active-section');
        if(sec === 'buscador') buscarEventos(0);
    }

    // --- LOGICA DE B√öSQUEDA (CORREGIDA) ---
    async function cargarGeneros() {
        try {
            const res = await fetch('/api/eventos/generos');
            if(res.ok) {
                const gens = await res.json();
                const sel = document.getElementById('s-genero');
                gens.forEach(g => { if(g && g !== 'Undefined') sel.innerHTML += `<option value="${g}">${g}</option>`; });
            }
        } catch(e) {}
    }

    async function buscarEventos(p) {
        curPage = p >= 0 ? p : 0;
        const grid = document.getElementById('eventos-grid');
        grid.innerHTML = '<div class="text-center w-100 py-5"><div class="spinner-border text-primary"></div></div>';

        // RECOGIDA DE TODOS LOS FILTROS
        const ciudad = document.getElementById('s-ciudad').value;
        const keyword = document.getElementById('s-key').value;
        const fecha = document.getElementById('s-fecha').value; // YYYY-MM-DD
        const genero = document.getElementById('s-genero').value;

        let query = `page=${curPage}&size=9`;
        if(ciudad) query += `&ciudad=${ciudad}`;
        if(keyword) query += `&keyword=${encodeURIComponent(keyword)}`;
        if(fecha) query += `&fechaInicio=${fecha}T00:00:00`; // Formato LocalDateTime
        if(genero) query += `&genero=${encodeURIComponent(genero)}`;

        try {
            const res = await fetch(`/api/eventos/buscar?${query}`);
            const data = await res.json();

            // Manejo de estructura Page de Spring
            const list = data.content || [];
            const pageMeta = data.page || data; // Dependiendo de la versi√≥n de Spring Data
            totalPages = pageMeta.totalPages || 0;
            const totalElements = pageMeta.totalElements || 0;

            document.getElementById('results-info').innerText = `${totalElements} eventos encontrados`;

            grid.innerHTML = '';
            if(!list.length) {
                grid.innerHTML = '<div class="alert alert-info w-100 text-center">No se encontraron eventos con estos filtros.</div>';
                actualizarPaginacion(0,0);
                return;
            }

            list.forEach(ev => {
                const dateStr = new Date(ev.fechaEvento).toLocaleDateString('es-ES', {day:'numeric', month:'short', hour:'2-digit', minute:'2-digit'});
                const precio = ev.precio ? ev.precio + ' ‚Ç¨' : 'Gratis';

                // Botones admin
                let adminBtns = '';
                if(user && user.rol === 'ADMIN') {
                    adminBtns = `<div class="mt-2 pt-2 border-top d-flex gap-2 justify-content-center">
                        <button class="btn btn-sm btn-outline-primary" onclick="editarEvento(${ev.id}, event)">Editar</button>
                        <button class="btn btn-sm btn-outline-danger" onclick="borrarEvento(${ev.id}, event)">Borrar</button>
                    </div>`;
                }

                grid.innerHTML += `
                    <div class="col-md-4 col-sm-6">
                        <div class="card h-100 cursor-pointer" onclick="verDetalle(${ev.id})">
                            <div class="position-relative">
                                <img src="${ev.imageUrl || 'https://via.placeholder.com/300'}" class="card-img-top">
                                <span class="price-badge">${precio}</span>
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h5 class="fw-bold text-truncate" title="${ev.titulo}">${ev.titulo}</h5>
                                <p class="text-muted small mb-1"><i class="bi bi-calendar"></i> ${dateStr}</p>
                                <p class="text-muted small"><i class="bi bi-geo-alt"></i> ${ev.recinto ? ev.recinto.ciudad : 'Ubicaci√≥n pendiente'}</p>
                                <button class="btn btn-outline-dark w-100 btn-sm mt-auto">Ver Entradas</button>
                                ${adminBtns}
                            </div>
                        </div>
                    </div>`;
            });
            actualizarPaginacion(curPage, totalPages);

        } catch(e) { console.error(e); }
    }

    function actualizarPaginacion(cur, total) {
        document.getElementById('page-info').innerText = total > 0 ? `P√°gina ${cur + 1} de ${total}` : '0 de 0';
        document.getElementById('btn-prev').disabled = cur === 0;
        document.getElementById('btn-next').disabled = cur >= total - 1 || total === 0;
    }

    function cambiarPagina(d) {
        if(curPage + d >= 0 && curPage + d < totalPages) buscarEventos(curPage + d);
    }

    // --- DETALLE & CARRITO ---
    async function verDetalle(id) {
        selectedEventId = id;
        try {
            const res = await fetch(`/api/eventos/${id}`); // Aseg√∫rate de tener este endpoint GET
            if(!res.ok) throw new Error("Error cargando evento");
            const ev = await res.json();

            document.getElementById('d-title').innerText = ev.titulo;
            document.getElementById('d-price').innerText = (ev.precio || 0) + ' ‚Ç¨';
            document.getElementById('d-date').innerText = new Date(ev.fechaEvento).toLocaleDateString();
            document.getElementById('d-desc').innerText = ev.descripcion || "Disfruta de este incre√≠ble evento.";
            document.getElementById('d-img').src = ev.imageUrl || 'https://via.placeholder.com/500';
            document.getElementById('d-qty').value = 1;

            new bootstrap.Modal(document.getElementById('detailModal')).show();
        } catch(e) { Swal.fire('Error', 'No se pudo cargar el detalle del evento', 'error'); }
    }

    async function agregarAlCarrito() {
        if(!user) {
            bootstrap.Modal.getInstance(document.getElementById('detailModal')).hide();
            Swal.fire('Atenci√≥n', 'Debes iniciar sesi√≥n para comprar', 'warning');
            new bootstrap.Modal(document.getElementById('loginModal')).show();
            return;
        }

        const qty = document.getElementById('d-qty').value;
        const btn = document.querySelector('#detailModal .btn-dark');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> A√±adiendo...';
        btn.disabled = true;

        try {
            // POST al backend
            const res = await fetch(`/api/carrito/agregar?usuarioId=${user.id}&eventoId=${selectedEventId}&cantidad=${qty}`, {method: 'POST'});

            if(res.ok) {
                bootstrap.Modal.getInstance(document.getElementById('detailModal')).hide();
                Swal.fire({icon: 'success', title: '¬°A√±adido!', text: 'Producto en el carrito', timer: 1500, showConfirmButton: false});
                cargarCarritoCount(); // Actualizamos el numerito
            } else {
                Swal.fire('Error', 'No se pudo a√±adir al carrito', 'error');
            }
        } catch(e) { console.error(e); }
        finally {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    }

    async function cargarCarritoCount() {
        try {
            const res = await fetch(`/api/carrito/${user.id}`);
            if(res.ok) {
                const cart = await res.json();
                // Sumamos cantidades de todas las l√≠neas
                const count = cart.lineas ? cart.lineas.reduce((acc, el) => acc + el.cantidad, 0) : 0;
                document.getElementById('cart-count').innerText = count;
            }
        } catch(e) {}
    }

    async function abrirCarrito() {
        if(!user) return;
        const list = document.getElementById('cart-list');
        const loader = document.getElementById('cart-loading');

        list.innerHTML = '';
        loader.classList.remove('d-none'); // Mostrar spinner
        new bootstrap.Modal(document.getElementById('cartModal')).show();

        try {
            // SIEMPRE pedimos datos frescos al servidor al abrir el modal
            const res = await fetch(`/api/carrito/${user.id}`);
            const cart = await res.json();

            loader.classList.add('d-none');
            let total = 0;

            if(!cart.lineas || cart.lineas.length === 0) {
                list.innerHTML = '<li class="list-group-item text-center py-4 text-muted">Tu carrito est√° vac√≠o üò¢</li>';
            } else {
                cart.lineas.forEach(l => {
                    const sub = l.cantidad * (l.evento.precio || 0);
                    total += sub;
                    list.innerHTML += `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <div class="fw-bold">${l.evento.titulo}</div>
                                <div class="small text-muted">
                                    ${l.cantidad} entradas x ${l.evento.precio} ‚Ç¨
                                </div>
                            </div>
                            <span class="fw-bold text-dark">${sub.toFixed(2)} ‚Ç¨</span>
                        </li>`;
                });
            }
            document.getElementById('cart-total').innerText = total.toFixed(2) + ' ‚Ç¨';

        } catch(e) {
            loader.classList.add('d-none');
            list.innerHTML = '<li class="list-group-item text-danger">Error cargando carrito</li>';
        }
    }

    async function checkout() {
        if(!user) return;
        try {
            const res = await fetch(`/api/carrito/checkout/${user.id}`, {method: 'POST'});
            if(res.ok) {
                bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
                Swal.fire('¬°Compra Exitosa!', 'Te hemos enviado las entradas a tu correo.', 'success');
                cargarCarritoCount();
            } else {
                Swal.fire('Error', 'Fallo al procesar compra', 'error');
            }
        } catch(e) {}
    }

    // --- GESTI√ìN DE USUARIOS & ADMIN ---
    document.getElementById('formLogin').onsubmit = async (e) => {
        e.preventDefault();
        const email = document.getElementById('logEmail').value;
        const pass = document.getElementById('logPass').value;
        try {
            const res = await fetch('/api/auth/login', {
                method: 'POST', headers: {'Content-Type':'application/json'},
                body: JSON.stringify({email, password: pass})
            });
            if(res.ok) {
                user = await res.json();
                localStorage.setItem('ticketUser', JSON.stringify(user));
                bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
                updateUserUI();
                cargarCarritoCount();
                Swal.fire({icon:'success', title: 'Bienvenido ' + user.nombre, timer: 1500, showConfirmButton:false});
            } else Swal.fire('Error', 'Credenciales incorrectas', 'error');
        } catch(e){}
    };

    function updateUserUI() {
        if(user) {
            document.getElementById('nav-login').classList.add('d-none');
            document.getElementById('nav-user').classList.remove('d-none');
            document.getElementById('nav-cart').classList.remove('d-none');
            document.getElementById('user-name').innerText = user.nombre;
            if(user.rol === 'ADMIN') document.querySelectorAll('.admin-controls').forEach(el => el.style.display = 'block');
        } else {
            document.getElementById('nav-login').classList.remove('d-none');
            document.getElementById('nav-user').classList.add('d-none');
            document.getElementById('nav-cart').classList.add('d-none');
            document.querySelectorAll('.admin-controls').forEach(el => el.style.display = 'none');
        }
    }

    function logout() { localStorage.removeItem('ticketUser'); location.reload(); }

    // Funci√≥n auxiliar para editar (detener propagaci√≥n del click en card)
    window.editarEvento = function(id, event) {
        event.stopPropagation();
        // L√≥gica de abrir modal admin...
        console.log("Editando " + id);
        // Aqu√≠ ir√≠a el fetch para rellenar el formulario admin
        new bootstrap.Modal(document.getElementById('eventoModal')).show();
    };
    window.borrarEvento = async function(id, event) {
        event.stopPropagation();
        if((await Swal.fire({title:'¬øBorrar?', icon:'warning', showCancelButton:true})).isConfirmed) {
            await fetch(`/api/eventos/${id}`, {method:'DELETE'});
            buscarEventos(curPage);
        }
    };
    async function guardarEvento() {
        const id = document.getElementById('evId').value;
        const titulo = document.getElementById('evTitulo').value;
        const precio = parseFloat(document.getElementById('evPrecio').value);
        const fecha = document.getElementById('evFecha').value;
        const imageUrl = document.getElementById('evImage').value;

        const eventoData = {titulo, precio, fechaEvento: fecha, imageUrl};

        try {
            let res;
            if(id) {
                res = await fetch(`/api/eventos/${id}`, {
                    method: 'PUT', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify(eventoData)
                });
            } else {
                res = await fetch('/api/eventos', {
                    method: 'POST', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify(eventoData)
                });
            }

            if(res.ok) {
                bootstrap.Modal.getInstance(document.getElementById('eventoModal')).hide();
                Swal.fire('√âxito', 'Evento guardado correctamente', 'success');
                buscarEventos(curPage);
            } else {
                Swal.fire('Error', 'No se pudo guardar el evento', 'error');
            }
        } catch(e) { console.error(e); }
    }
</script>
</body>
</html>